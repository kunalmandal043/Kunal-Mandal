(function() {
  function initMobileMenu() {
    const menuToggle = document.getElementById('mobile-menu-toggle');
    const mobileDropdown = document.getElementById('mobile-dropdown');
    const menuIcon = menuToggle.querySelector('.menu-icon');
    const closeIcon = menuToggle.querySelector('.close-icon');
    const body = document.body;

    if (!menuToggle || !mobileDropdown) return;

    function toggleMenu() {
      const isOpen = mobileDropdown.classList.contains('active');

      if (isOpen) {
        // Start closing animation
        mobileDropdown.classList.add('closing');
        mobileDropdown.classList.remove('active');
        body.classList.remove('mobile-menu-open');
        if (menuIcon) menuIcon.style.display = 'block';
        if (closeIcon) closeIcon.style.display = 'none';

        setTimeout(() => {
          mobileDropdown.classList.remove('closing');
        }, 300); // match CSS transition
      } else {
        // Open menu
        mobileDropdown.classList.add('active');
        if (menuIcon) menuIcon.style.display = 'none';
        if (closeIcon) closeIcon.style.display = 'block';
        body.classList.add('mobile-menu-open');
      }
    }

    menuToggle.addEventListener('click', e => {
      e.stopPropagation();
      toggleMenu();
    });

    mobileDropdown.addEventListener('click', e => {
      if (e.target === mobileDropdown) toggleMenu();
    });

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape' && mobileDropdown.classList.contains('active')) {
        toggleMenu();
      }
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMobileMenu);
  } else {
    initMobileMenu();
  }
})();
